package Utilitats

import javax.swing.*
import java.awt.*
import java.io.File


class Finestra : JFrame() {
	val fCh = JFileChooser(".")
	val taula = JTable(1, 6)
	val area = JTextArea(10, 50)


	init {

		defaultCloseOperation = JFrame.EXIT_ON_CLOSE
		setTitle("Crear apunts Quotes")
		//setSize(400, 300)
		setLayout(GridLayout(2, 1))

		val panell1 = JPanel(BorderLayout())
		val panell11 = JPanel(FlowLayout())
		val panell12 = JPanel(BorderLayout())
		add(panell1)
		panell1.add(panell11, BorderLayout.NORTH)
		panell1.add(panell12, BorderLayout.CENTER)


		val fitxer = JTextField(25)
		panell11.add(fitxer)
		val botoTriarFitxer = JButton("Triar fitxer")
		panell11.add(botoTriarFitxer)


		panell12.add(JLabel("Llista de m√∫sics i quotes:"), BorderLayout.NORTH)
		taula.setEnabled(false)
		val scroll = JScrollPane(taula)
		panell12.add(scroll, null)

		botoTriarFitxer.addActionListener {
			val r = fCh.showOpenDialog(this)
			if (r == JFileChooser.APPROVE_OPTION) {
				fitxer.setText(fCh.getSelectedFile().getName())
				val f = fCh.getSelectedFile()
				val linies = f.readLines()

				plenarTaula(linies)
			}
		}
		val botoPassarSQL = JButton("Convertir SQL")
		panell1.add(botoPassarSQL, BorderLayout.SOUTH)
		botoPassarSQL.addActionListener {
			area.setText("")
			for (l in 0 until taula.getRowCount()) {
				var cadena = "INSERT INTO DIARIO VALUES ("
				cadena += taula.getModel().getValueAt(l, 0)
				area.append(cadena + ")\n")
			}
		}
		val panell2 = JPanel(BorderLayout())
		add(panell2)
		panell2.add(area)
		pack()

	}

	fun plenarTaula(linies: List<String>) {
		var ll = Array(linies.size) { arrayOfNulls<String>(6) }
		var compt = 0
		for (i in 0 until linies.size) {
			val camps = linies.get(i).split(";")
			if (camps.get(5) != "0") {
				for (j in 0 until camps.size) {
					ll[compt][j] = camps.get(j)

				}
				compt++
			}
		}
		val ll2 = Array(compt) { arrayOfNulls<String>(6) }
		ll.copyInto(ll2, 0, 0, compt)
		val caps = arrayOf("Num", "Cognoms", "Nom", "Data", "Estudis", "Quota")
		taula.setModel(javax.swing.table.DefaultTableModel(ll2, caps))
	}
}


fun main(args: Array<String>) {
	EventQueue.invokeLater {
		Finestra().isVisible = true
	}
}

